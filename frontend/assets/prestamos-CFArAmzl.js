import{_ as w,c as i,o as c,b as e,p as b,v as y,F as p,f as v,t as a,d as u,q as D,i as _,l as g,j as x}from"./index-BzoUKLuT.js";import{d as m}from"./es-CSMndH0g.js";import{u as f,w as E}from"./xlsx-xCRnwQcp.js";const C={name:"PrestamosTable",data(){return{authStore:x(),selectedEstado:"TODOS",estadosDisponibles:[],prestamos:[],searchTerm:"",hoveredButton:"",hoveredId:null,loaderStore:g()}},computed:{filteredPrestamos(){return this.prestamos.filter(t=>(t.referencia1||"").toLowerCase().includes(this.searchTerm.toLowerCase())||(t.referencia2||"").toLowerCase().includes(this.searchTerm.toLowerCase())||(t.referencia3||"").toLowerCase().includes(this.searchTerm.toLowerCase())||(t.cliente_nombre||"").toLowerCase().includes(this.searchTerm.toLowerCase())||(t.usuario_nombre||"").toLowerCase().includes(this.searchTerm.toLowerCase()))}},async mounted(){await this.fetchEstados(),await this.fetchPrestamos()},methods:{getEstadoClass(t){if(!t)return"text-secondary";const s=t.toLowerCase();return s.includes("disponible")?"fw-bold":s.includes("solicitado")||s.includes("entrega")||s.includes("progreso")||s.includes("devuelto")||s.includes("rechazado")||s.includes("anulado")?" fw-bold":"text-secondary fw-bold"},async fetchEstados(){try{const t=await _.post("/api/estados/listar",{tipo:"devolucion"});this.estadosDisponibles=t.data.data||["TODOS"]}catch(t){console.error("Error al obtener los estados de préstamos:",t)}},async fetchPrestamos(){try{const t=this.authStore.clienteId;if(!t){console.error("❌ Error: Cliente ID no encontrado.");return}const s={estado:this.selectedEstado==="TODOS"?["TODOS"]:[this.selectedEstado],idCliente:t},r=await _.post("/api/prestamosReports",s);this.prestamos=r.data.map(l=>{var n,d,o;return{id:l.id,cliente_nombre:l.cliente_nombre,usuario_nombre:l.usuario_nombre,objeto:((n=l.custodia)==null?void 0:n.item)||"N/A",bodega:((o=(d=l.custodia)==null?void 0:d.bodega)==null?void 0:o.nombre)||"N/A",referencia1:l.referencia1||"N/A",referencia2:l.referencia2||"N/A",referencia3:l.referencia3||"N/A",estado:l.estado,modalidad:l.modalidad||"N/A",direccion_entrega:l.direccion_entrega||"N/A",observaciones:l.observaciones||"N/A",fechaEstimada:l.fechaEstimada,urlPdf:l.urlPdf||null}}),this.loaderStore.hideLoader()}catch(t){console.error("Error al obtener datos de préstamos:",t)}},formatDate(t){return t?m(t).locale("es").format("DD/MM/YYYY HH:mm"):"N/A"},downloadFile(t){window.open(t,"_blank")},exportToExcel(){const t=f.json_to_sheet(this.filteredPrestamos.map(r=>({ID:r.id,Cliente:r.cliente_nombre,Usuario:r.usuario_nombre,Objeto:r.objeto,Bodega:r.bodega,"Referencia 1":r.referencia1,"Referencia 2":r.referencia2,"Referencia 3":r.referencia3,Estado:r.estado,Modalidad:r.modalidad,"Dirección Entrega":r.direccion_entrega,Observaciones:r.observaciones,"Fecha Estimada":this.formatDate(r.fechaEstimada),"URL PDF":r.urlPdf||"N/A"}))),s=f.book_new();f.book_append_sheet(s,t,"Prestamos"),E(s,`Bodegapp_Prestamos_${m().format("YYYY-MM-DD")}.xlsx`)}}},T={class:"inventario-container px-3 py-0 mt-0 py-0 mt-0"},k={class:"card shadow"},P={class:"card-header px-0 py-0"},L={class:"row align-items-center m-0 p-0 py-3 d-flex justify-content-between"},O={class:"col-auto"},S={class:"custom-select"},B=["value"],M={class:"col-auto d-flex align-items-center gap-2"},A={key:0},N={key:1},F={class:"custom-search"},I={class:"card-body m-0 p-0"},j={class:"table-container"},R={class:"table table-sm table-bordered table-hover sticky-content"},Y={class:"text-uppercase"},U=["onClick","onMouseover"],V={key:0},q={key:1};function z(t,s,r,l,n,d){return c(),i("div",T,[e("div",k,[e("div",P,[e("div",L,[e("div",O,[e("div",S,[b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>n.selectedEstado=o),onChange:s[1]||(s[1]=(...o)=>d.fetchPrestamos&&d.fetchPrestamos(...o))},[s[7]||(s[7]=e("option",{value:"TODOS"},"Todos",-1)),(c(!0),i(p,null,v(n.estadosDisponibles,o=>(c(),i("option",{key:o,value:o},a(o),9,B))),128))],544),[[y,n.selectedEstado]])])]),s[9]||(s[9]=e("div",{class:"custom-select"},null,-1)),e("div",M,[e("button",{class:"custom-btn excel me-2",onClick:s[2]||(s[2]=(...o)=>d.exportToExcel&&d.exportToExcel(...o)),onMouseover:s[3]||(s[3]=o=>n.hoveredButton="excel"),onMouseleave:s[4]||(s[4]=o=>n.hoveredButton="")},[e("i",{class:u(n.hoveredButton==="excel"?"bi bi-arrow-down-circle-fill":"bi bi-file-excel-fill")},null,2),n.hoveredButton!=="excel"?(c(),i("span",A,"Excel")):(c(),i("span",N,"Descargar"))],32),e("div",F,[s[8]||(s[8]=e("i",{class:"bi bi-search search-icon"},null,-1)),b(e("input",{type:"text",class:"form-control form-control-sm",placeholder:"Buscar","onUpdate:modelValue":s[5]||(s[5]=o=>n.searchTerm=o)},null,512),[[D,n.searchTerm]])])])])]),e("div",I,[e("div",j,[e("table",R,[s[10]||(s[10]=e("thead",{class:"sticky-header"},[e("tr",null,[e("th",null,"ID"),e("th",null,"Cliente"),e("th",null,"Usuario"),e("th",null,"Objeto"),e("th",null,"Bodega"),e("th",null,"Referencia 1"),e("th",null,"Referencia 2"),e("th",null,"Referencia 3"),e("th",null,"Estado"),e("th",null,"Modalidad"),e("th",null,"Dirección Entrega"),e("th",null,"Observaciones"),e("th",null,"Fecha Estimada"),e("th",null,"Descargar PDF")])],-1)),e("tbody",null,[(c(!0),i(p,null,v(d.filteredPrestamos,o=>(c(),i("tr",{key:o.id},[e("td",null,a(o.id),1),e("td",null,a(o.cliente_nombre),1),e("td",null,a(o.usuario_nombre),1),e("td",null,a(o.objeto),1),e("td",null,a(o.bodega),1),e("td",null,a(o.referencia1),1),e("td",null,a(o.referencia2),1),e("td",null,a(o.referencia3),1),e("td",Y,[e("span",{class:u(d.getEstadoClass(o.estado))},a(o.estado),3)]),e("td",null,a(o.modalidad),1),e("td",null,a(o.direccion_entrega),1),e("td",null,a(o.observaciones),1),e("td",null,a(d.formatDate(o.fechaEstimada)),1),e("td",null,[e("button",{class:"custom-btn pdf",style:{height:"22px !important"},onClick:h=>d.downloadFile(o.urlPdf),onMouseover:h=>n.hoveredId=o.id,onMouseleave:s[6]||(s[6]=h=>n.hoveredId=null)},[e("i",{class:u(n.hoveredId===o.id?"bi bi-arrow-down-circle-fill":"bi bi-file-earmark-pdf-fill")},null,2),n.hoveredId!==o.id?(c(),i("span",V,"PDF")):(c(),i("span",q,"Descargar"))],40,U)])]))),128))])])])])])])}const K=w(C,[["render",z]]);export{K as default};
