import{_,c as a,o as l,b as e,p as m,v as x,F as b,f as g,t as c,d as h,q as y,S as p,i as f,l as A,j as C}from"./index-BzoUKLuT.js";import{d as w}from"./es-CSMndH0g.js";import{u as v,w as E}from"./xlsx-xCRnwQcp.js";const D={name:"PrestamosTable",data(){return{authStore:C(),selectedEstado:"TODOS",estadosDisponibles:[],prestamos:[],searchTerm:"",hoveredButton:"",hoveredId:null,loaderStore:A()}},computed:{filteredPrestamos(){const s=this.searchTerm.toLowerCase();return this.prestamos.filter(t=>String(t.id).toLowerCase().includes(s)||String(t.clienteId).toLowerCase().includes(s)||String(t.consecutivo).toLowerCase().includes(s)||t.entregadoPor&&t.entregadoPor.toLowerCase().includes(s)||t.estado&&t.estado.toLowerCase().includes(s)||t.observaciones&&t.observaciones.toLowerCase().includes(s))}},async mounted(){await this.fetchEstados(),await this.fetchPrestamos()},methods:{getEstadoClass(s){if(!s)return"text-secondary";const t=s.toLowerCase();return t.includes("pendiente")?"text-warning fw-bold":t.includes("entregado")?"text-success fw-bold":t.includes("rechazado")?"text-danger fw-bold":t.includes("anulado")?"text-muted fw-bold":"text-secondary fw-bold"},async fetchEstados(){try{const s=await f.post("/api/estados/listar",{tipo:"devolucion"});this.estadosDisponibles=s.data.data||["TODOS"]}catch(s){console.error("Error al obtener los estados:",s)}},async fetchPrestamos(){this.loaderStore.showLoader();try{const s=this.authStore.clienteId;if(!s){console.error("Error: Cliente ID no encontrado."),this.loaderStore.hideLoader();return}const t={clienteId:s},r=await f.post("/api/entregas/listar",t);this.prestamos=r.data.data.map(n=>({id:n.id,clienteId:n.clienteId,consecutivo:n.consecutivo,createdAt:n.createdAt,entregadoPor:n.entregadoPor,estado:n.estado,fechaEntrega:n.fechaEntrega,observaciones:n.observaciones,pdfPath:n.pdfPath,prescinto:n.prescinto,signatureA:n.signatureA,signatureB:n.signatureB,sticker:n.sticker,timestamp:n.timestamp,updatedAt:n.updatedAt}))}catch(s){console.error("Error al obtener datos de entregas:",s)}finally{this.loaderStore.hideLoader()}},formatDate(s){return s?w(s).locale("es").format("DD/MM/YYYY HH:mm"):"N/A"},downloadFile(s){s?window.open(s,"_blank"):console.warn("URL del archivo no disponible.")},exportToExcel(){const s=v.json_to_sheet(this.filteredPrestamos.map(r=>({ID:r.id,"Cliente ID":r.clienteId,Consecutivo:r.consecutivo,Creado:this.formatDate(r.createdAt),"Entregado Por":r.entregadoPor,Estado:r.estado,"Fecha Entrega":this.formatDate(r.fechaEntrega),Observaciones:r.observaciones,"Ruta PDF":r.pdfPath||"N/A",Prescinto:r.prescinto||"N/A","Firma A":r.signatureA||"N/A","Firma B":r.signatureB||"N/A",Sticker:r.sticker||"N/A",Timestamp:r.timestamp,Actualizado:this.formatDate(r.updatedAt)}))),t=v.book_new();v.book_append_sheet(t,s,"Entregas"),E(t,`Bodegapp_Entregas_${w().format("YYYY-MM-DD")}.xlsx`)},async confirmEntrega(s){var n,d;const t=`
        <div style="text-align:left;">
          <p><strong>ID:</strong> ${s.id}</p>
          <p><strong>Cliente ID:</strong> ${s.clienteId}</p>
          <p><strong>Consecutivo:</strong> ${s.consecutivo}</p>
          <p><strong>Observaciones:</strong> ${s.observaciones||"N/A"}</p>
        </div>
      `;if((await p.fire({title:"Confirmar entrega",html:t,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, confirmar",cancelButtonText:"Cancelar"})).isConfirmed)try{this.loaderStore.showLoader();const i={entregaId:s.id,estado:"ENTREGA CONFIRMADA",clienteId:s.clienteId},u=(await f.put("/api/entregas/confirmar",i)).data.message||"Entrega confirmada exitosamente";s.estado="ENTREGA CONFIRMADA",p.fire({icon:"success",title:u,toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3})}catch(i){console.error("Error al confirmar entrega:",i),p.fire({icon:"error",title:"Error al confirmar",text:((d=(n=i.response)==null?void 0:n.data)==null?void 0:d.message)||"Ocurrió un error",toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3})}finally{this.loaderStore.hideLoader()}}}},k={class:"inventario-container px-3 py-0 mt-0"},I={class:"card shadow"},P={class:"card-header px-0 py-0"},B={class:"row align-items-center m-0 p-0 py-3 d-flex justify-content-between"},S={class:"col-auto"},T={class:"custom-select"},F=["value"],N={class:"col-auto d-flex align-items-center gap-2"},L={key:0},M={key:1},O={class:"custom-search"},R={class:"card-body m-0 p-0"},Y={class:"table-container"},j={class:"table table-sm table-bordered table-hover sticky-content"},q={class:"text-uppercase"},z=["onClick","onMouseover"],G={key:0},U={key:1},V={key:1},H=["src"],J={key:1},K=["src"],Q={key:1},W=["onClick"],X={key:1,class:"text-success fw-bold"};function Z(s,t,r,n,d,i){return l(),a("div",k,[e("div",I,[e("div",P,[e("div",B,[e("div",S,[e("div",T,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>d.selectedEstado=o),onChange:t[1]||(t[1]=(...o)=>i.fetchPrestamos&&i.fetchPrestamos(...o))},[t[7]||(t[7]=e("option",{value:"TODOS"},"Todos",-1)),(l(!0),a(b,null,g(d.estadosDisponibles,o=>(l(),a("option",{key:o,value:o},c(o),9,F))),128))],544),[[x,d.selectedEstado]])])]),e("div",N,[e("button",{class:"custom-btn excel me-2",onClick:t[2]||(t[2]=(...o)=>i.exportToExcel&&i.exportToExcel(...o)),onMouseover:t[3]||(t[3]=o=>d.hoveredButton="excel"),onMouseleave:t[4]||(t[4]=o=>d.hoveredButton="")},[e("i",{class:h(d.hoveredButton==="excel"?"bi bi-arrow-down-circle-fill":"bi bi-file-excel-fill")},null,2),d.hoveredButton!=="excel"?(l(),a("span",L,"Excel")):(l(),a("span",M,"Descargar"))],32),e("div",O,[t[8]||(t[8]=e("i",{class:"bi bi-search search-icon"},null,-1)),m(e("input",{type:"text",class:"form-control form-control-sm",placeholder:"Buscar","onUpdate:modelValue":t[5]||(t[5]=o=>d.searchTerm=o)},null,512),[[y,d.searchTerm]])])])])]),e("div",R,[e("div",Y,[e("table",j,[t[9]||(t[9]=e("thead",{class:"sticky-header"},[e("tr",null,[e("th",null,"ID"),e("th",null,"Cliente ID"),e("th",null,"Consecutivo"),e("th",null,"Creado"),e("th",null,"Entregado Por"),e("th",null,"Estado"),e("th",null,"Fecha Entrega"),e("th",null,"Observaciones"),e("th",null,"PDF"),e("th",null,"Prescinto"),e("th",null,"Firma A"),e("th",null,"Firma B"),e("th",null,"Sticker"),e("th",null,"Timestamp"),e("th",null,"Actualizado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(l(!0),a(b,null,g(i.filteredPrestamos,o=>(l(),a("tr",{key:o.id},[e("td",null,c(o.id),1),e("td",null,c(o.clienteId),1),e("td",null,c(o.consecutivo),1),e("td",null,c(i.formatDate(o.createdAt)),1),e("td",null,c(o.entregadoPor),1),e("td",q,[e("span",{class:h(i.getEstadoClass(o.estado))},c(o.estado),3)]),e("td",null,c(i.formatDate(o.fechaEntrega)),1),e("td",null,c(o.observaciones),1),e("td",null,[o.pdfPath?(l(),a("button",{key:0,class:"custom-btn pdf",style:{height:"22px !important"},onClick:u=>i.downloadFile(o.pdfPath),onMouseover:u=>d.hoveredId=o.id,onMouseleave:t[6]||(t[6]=u=>d.hoveredId=null)},[e("i",{class:h(d.hoveredId===o.id?"bi bi-arrow-down-circle-fill":"bi bi-file-earmark-pdf-fill")},null,2),d.hoveredId!==o.id?(l(),a("span",G,"PDF")):(l(),a("span",U,"Descargar"))],40,z)):(l(),a("span",V,"N/A"))]),e("td",null,c(o.prescinto||"N/A"),1),e("td",null,[o.signatureA?(l(),a("img",{key:0,src:o.signatureA,alt:"Firma A",style:{"max-width":"100px","max-height":"50px"}},null,8,H)):(l(),a("span",J,"N/A"))]),e("td",null,[o.signatureB?(l(),a("img",{key:0,src:o.signatureB,alt:"Firma B",style:{"max-width":"100px","max-height":"50px"}},null,8,K)):(l(),a("span",Q,"N/A"))]),e("td",null,c(o.sticker||"N/A"),1),e("td",null,c(o.timestamp),1),e("td",null,c(i.formatDate(o.updatedAt)),1),e("td",null,[o.estado!=="ENTREGA CONFIRMADA"?(l(),a("button",{key:0,class:"custom-btn",onClick:u=>i.confirmEntrega(o)}," Confirmar ",8,W)):(l(),a("span",X,"Confirmada"))])]))),128))])])])])])])}const oe=_(D,[["render",Z],["__scopeId","data-v-cf887114"]]);export{oe as default};
