import{_ as D,c as a,o as l,b as e,F as u,f as h,p as b,v as y,t as c,d as m,q as k,x as w,h as g,i as f,l as S,j as F}from"./index-BzoUKLuT.js";import{d as x}from"./es-CSMndH0g.js";import{u as _,w as E}from"./xlsx-xCRnwQcp.js";const B={name:"ProfessionalTableSkeleton",props:{columns:{type:Number,default:5},rows:{type:Number,default:5}}},T={class:"table-skeleton"},L={class:"table-header-skeleton"};function C(r,o,s,v,n,i){return l(),a("div",T,[e("div",L,[(l(!0),a(u,null,h(s.columns,d=>(l(),a("div",{key:"header-"+d,class:"header-cell skeleton-cell"}))),128))]),(l(!0),a(u,null,h(s.rows,d=>(l(),a("div",{key:"row-"+d,class:"table-row-skeleton"},[(l(!0),a(u,null,h(s.columns,t=>(l(),a("div",{key:"cell-"+d+"-"+t,class:"row-cell skeleton-cell"}))),128))]))),128))])}const M=D(B,[["render",C],["__scopeId","data-v-eccfee0f"]]),O={name:"DevolucionesTable",data(){return{authStore:F(),selectedEstado:"TODOS",estadosDisponibles:[],devoluciones:[],searchTerm:"",hoveredButton:"",hoveredId:null,loaderStore:S(),isLoading:!0}},components:{SkeletonLoader:M},computed:{filteredDevoluciones(){return this.devoluciones.filter(r=>[r.referencia1,r.referencia2,r.referencia3,r.cliente_nombre,r.usuario_nombre].filter(Boolean).some(o=>o.toLowerCase().includes(this.searchTerm.toLowerCase())))}},async mounted(){await this.fetchEstados(),await this.fetchDevoluciones()},methods:{async fetchEstados(){try{const r=await f.post("/api/estados/listar",{tipo:"devolucion"});this.estadosDisponibles=r.data.data||["TODOS"]}catch(r){console.error("Error al obtener los estados de préstamos:",r)}},async fetchDevoluciones(){try{const r=this.authStore.clienteId;if(!r){console.error("❌ Error: Cliente ID no encontrado.");return}const o={clienteId:r,estado:this.selectedEstado},s=await f.post("/api/devolucionesReports",o);this.devoluciones=s.data,this.isLoading=!1,this.loaderStore.hideLoader()}catch(r){console.error("❌ Error al obtener datos de devoluciones:",r),setTimeout(()=>{this.isLoading=!1},1500),this.loaderStore.hideLoader()}},async downloadFile(r){try{const o=this.authStore.token,s=await f.post("/api/downloadReportsPdf",{filename:"1233827.pdf"},{responseType:"blob",headers:{Authorization:`Bearer ${o}`}});console.log("🚀 ~ file: devoluciones.vue ~ line 138 ~ DevolucionesTable ~ downloadFile ~ response",s);const v=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=v,n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(o){console.error("❌ Error al descargar el PDF:",o)}},exportToExcel(){const r=_.json_to_sheet(this.filteredDevoluciones.map(s=>({ID:s.id,Cliente:s.cliente_nombre,Usuario:s.usuario_nombre,Custodia:s.custodia_item,"Referencia 1":s.referencia1,"Referencia 2":s.referencia2,"Referencia 3":s.referencia3,Estado:s.estado,Modalidad:s.modalidad,"Dirección Entrega":s.direccion_entrega,Observaciones:s.observaciones,"Fecha Solicitud":this.formatDate(s.fechaSolicitud),"Fecha Devolución":this.formatDate(s.FechaDevolucion),"Firma A":s.signatureA?"Firmado":"No Firmado","Firma B":s.signatureB?"Firmado":"No Firmado","URL PDF":s.urlPdf?"Disponible":"No disponible"}))),o=_.book_new();_.book_append_sheet(o,r,"Devoluciones"),E(o,`Bodegapp_Devoluciones_${x().format("YYYY-MM-DD")}.xlsx`)},formatDate(r){return r?x(r).locale("es").format("DD/MM/YYYY HH:mm"):"N/A"}}},I={class:"inventario-container px-3 py-0 mt-0"},R={class:"card shadow"},P={class:"card-header px-0 py-0"},Y={class:"row align-items-center m-0 p-0 py-3 d-flex justify-content-between"},N={class:"col-auto"},A={class:"custom-select"},U=["value"],j={class:"col-auto d-flex align-items-center gap-2"},V={key:0},q={key:1},z={class:"custom-search"},H={class:"card-body m-0 p-0"},G={key:1,class:"table-container"},J={class:"table table-sm table-bordered table-hover sticky-content"},K={class:"text-center"},Q={class:"text-center"},W={class:"text-center"},X={class:"text-center text-uppercase"},Z={class:"text-center"},$={class:"text-center"},ee={class:"text-center"},oe={class:"text-center"},te={class:"text-center"},se={class:"text-center"},re=["onClick","onMouseover"],ne={key:0},le={key:1};function ae(r,o,s,v,n,i){const d=g("SkeletonLoader");return l(),a("div",I,[e("div",R,[e("div",P,[e("div",Y,[e("div",N,[e("div",A,[b(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>n.selectedEstado=t),onChange:o[1]||(o[1]=(...t)=>i.fetchDevoluciones&&i.fetchDevoluciones(...t))},[o[7]||(o[7]=e("option",{value:"TODOS"},"TODOS",-1)),(l(!0),a(u,null,h(n.estadosDisponibles,t=>(l(),a("option",{key:t,value:t},c(t),9,U))),128))],544),[[y,n.selectedEstado]])])]),e("div",j,[e("button",{class:"custom-btn excel me-2",onClick:o[2]||(o[2]=(...t)=>i.exportToExcel&&i.exportToExcel(...t)),onMouseover:o[3]||(o[3]=t=>n.hoveredButton="excel"),onMouseleave:o[4]||(o[4]=t=>n.hoveredButton="")},[e("i",{class:m(n.hoveredButton==="excel"?"bi bi-arrow-down-circle-fill":"bi bi-file-excel-fill")},null,2),n.hoveredButton!=="excel"?(l(),a("span",V,"Excel")):(l(),a("span",q,"Descargar"))],32),e("div",z,[o[8]||(o[8]=e("i",{class:"bi bi-search search-icon"},null,-1)),b(e("input",{type:"text",class:"form-control form-control-sm",placeholder:"Buscar","onUpdate:modelValue":o[5]||(o[5]=t=>n.searchTerm=t)},null,512),[[k,n.searchTerm]])])])])]),e("div",H,[n.isLoading?(l(),w(d,{key:0,columns:10,rows:18})):(l(),a("div",G,[e("table",J,[o[9]||(o[9]=e("thead",{class:"sticky-header"},[e("tr",null,[e("th",{class:"text-center"},"Custodia"),e("th",{class:"text-center"},"Referencia 2"),e("th",{class:"text-center"},"Referencia 3"),e("th",{class:"text-center"},"Estado"),e("th",{class:"text-center"},"Modalidad"),e("th",{class:"text-center"},"Dirección Entrega"),e("th",{class:"text-center"},"Observaciones"),e("th",{class:"text-center"},"Fecha Solicitud"),e("th",{class:"text-center"},"Fecha Devolución"),e("th",{class:"text-center"},"Descargar PDF")])],-1)),e("tbody",null,[(l(!0),a(u,null,h(i.filteredDevoluciones,t=>(l(),a("tr",{key:t.id},[e("td",K,c(t.custodia_item),1),e("td",Q,c(t.referencia2),1),e("td",W,c(t.referencia3),1),e("td",X,[e("span",null,c(t.estado),1)]),e("td",Z,c(t.modalidad),1),e("td",$,c(t.direccion_entrega),1),e("td",ee,c(t.observaciones),1),e("td",oe,c(i.formatDate(t.fechaSolicitud)),1),e("td",te,c(i.formatDate(t.FechaDevolucion)),1),e("td",se,[e("button",{class:"custom-btn pdf",style:{height:"22px !important"},onClick:p=>i.downloadFile(t.urlPdf),onMouseover:p=>n.hoveredId=t.id,onMouseleave:o[6]||(o[6]=p=>n.hoveredId=null)},[e("i",{class:m(n.hoveredId===t.id?"bi bi-arrow-down-circle-fill":"bi bi-file-earmark-pdf-fill")},null,2),n.hoveredId!==t.id?(l(),a("span",ne,"PDF")):(l(),a("span",le,"Descargar"))],40,re)])]))),128))])])]))])])])}const ue=D(O,[["render",ae]]);export{ue as default};
